---
title: "svm_tigers_prediction"
author: "Xavier Owens"
date: "4/14/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readr)
library(fastDummies)
library(dplyr)

dat <- read_csv("2010_2019_DET_w_weather.csv")
dat <- select(dat, c("DH_Game","Year", "DOW", "Away", "H_Game_number", "H_Wins","A_Wins","Game_Time","Attendance", "PRCP", "TMAX", "TMIN",WT01,WT03,WT07, WT08, WT16,WT18))

#dat <-dat[-1]
dat$DOW <- as.factor(dat$DOW)
dat$DH_Game <- as.factor(dat$DH_Game)
dat$Year <- as.factor(dat$Year)
dat$Away <- as.factor(dat$Away)
dat$Game_Time <- as.factor(dat$Game_Time)

dat <- dummy_cols(dat, select_columns = c("DOW","DH_Game","Year", "Away", "Game_Time"))
dat$DOW <- NULL
dat$DH_Game <- NULL
dat$Year <- NULL
dat$Away <- NULL
dat$Game_Time <- NULL
normalize <- function(x) {
  return ((x - min(x)) / (max(x) - min(x)))
}
dat[5:7] <- as.data.frame(lapply(dat[5:7], normalize))

## 75% of the sample size
smp_size <- floor(0.75 * nrow(dat))

## set the seed to make your partition reproducible
set.seed(123)
train_ind <- sample(seq_len(nrow(dat)), size = smp_size)

train <-dat[train_ind, ]
test <- dat[-train_ind, ]

library(kernlab)
model.1 <- ksvm(Attendance ~ ., data = train,
                          kernel = "polydot", type = "eps-bsvr")

# look at basic information about the model
model.1

## Step 3: Evaluating model performance 
# predictions on testing dataset
model.1.predictions <- predict(model.1, test)
model.1.predictions <- as.integer(round(model.1.predictions))

oosmse <- mean((test$Attendance-model.1.predictions)^2)
summary(oosmse)
plot(x=test$Attendance, y=model.1.predictions, 
       xlab="Actual Attendance", ylab="Predicted Attendance")
  abline(a=0,b=1) 

lm_model <- lm(test$Attendance~model.1.predictions)
summary(lm_model)


```


```{r}
# look only at agreement vs. non-agreement
# construct a vector of TRUE/FALSE indicating correct/incorrect predictions
agree_tab <- data.frame(test$Attendance, model.1.predictions)
agree_tab$difference <- agree_tab$test.Attendance - agree_tab$model.1.predictions
limit <- 2000
agree_tab$agreement <- ifelse(abs(agree_tab$difference) <= limit, TRUE, FALSE)
prop.table(table(agree_tab$agreement))
hist(agree_tab$difference, breaks = seq(-30000,30000,500))
abline(v=limit,col="red")
abline(v=-limit,col="red")
```

